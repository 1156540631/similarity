void NetworkUtils::removeRouteFromInterface(CommandChain* aChain,CommandCallback aCallback,NetworkResultOptions& aResult)
modifyRouteOnInterface(aChain, aCallback, aResult, false);
void NetworkUtils::modifyRouteOnInterface(CommandChain* aChain,CommandCallback aCallback,NetworkResultOptions& aResult,bool aDoAdd)
char command[MAX_COMMAND_SIZE];
nsCString ipOrSubnetIp = NS_ConvertUTF16toUTF8(GET_FIELD(mIp));
nsCString gatewayOrEmpty;
const char* legacyOrEmpty = "legacy 0 ";
legacyOrEmpty = func(&legacyOrEmpty);
static char * func(char * *ptr)
char * legacyOrEmpty = *ptr;
if (GET_FIELD(mGateway).IsEmpty()) {
ipOrSubnetIp = getSubnetIp(ipOrSubnetIp, GET_FIELD(mPrefixLength));
legacyOrEmpty = "";
else
gatewayOrEmpty = nsCString(" ") + NS_ConvertUTF16toUTF8(GET_FIELD(mGateway));
return legacyOrEmpty;
legacyOrEmpty = func(&legacyOrEmpty);
const char* action = aDoAdd ? "add" : "remove";
PR_snprintf(command, MAX_COMMAND_SIZE - 1, "network route %s%s %d %s %s/%d%s",
legacyOrEmpty, action,
GET_FIELD(mNetId), GET_CHAR(mIfname), ipOrSubnetIp.get(),
GET_FIELD(mPrefixLength), gatewayOrEmpty.get());
